<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>QR-Based Attendance Portal</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <!-- QR Scanner Login Screen -->
    <div id="qr-scanner" class="screen active">
      <div class="container">
        <div class="login-card">
          <div class="qr-icon">
            <svg
              width="60"
              height="60"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <rect x="3" y="3" width="5" height="5" />
              <rect x="3" y="16" width="5" height="5" />
              <rect x="16" y="3" width="5" height="5" />
              <path d="m5 5 3 3" />
              <path d="m5 19 3-3" />
              <path d="m19 5-3 3" />
              <path d="M9 12h6" />
              <path d="M12 9v6" />
            </svg>
          </div>
          <h1>Attendance Portal</h1>
          <p>Scan QR code to access the portal</p>

          <div class="scan-area">
            <div class="qr-frame">
              <div class="corner top-left"></div>
              <div class="corner top-right"></div>
              <div class="corner bottom-left"></div>
              <div class="corner bottom-right"></div>
              <div class="scan-line"></div>
            </div>
          </div>

          <button id="scan-btn" class="scan-button">
            <span class="btn-text">Scan QR Code</span>
            <div class="spinner hidden"></div>
          </button>

          <div class="divider">or</div>

          <button id="manual-btn" class="manual-button">
            Enter Code Manually
          </button>

          <div id="success-message" class="success-message hidden">
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
              <polyline points="22,4 12,14.01 9,11.01" />
            </svg>
            <span>Authentication Successful</span>
            <p>Redirecting to portal...</p>
          </div>

          <div class="demo-info">
            <p>Demo: Use "admin123" for manual entry</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Attendance Portal Screen -->
    <div id="attendance-portal" class="screen">
      <header class="header">
        <div class="header-content">
          <div class="header-left">
            <div class="logo">
              <svg
                width="32"
                height="32"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" />
                <circle cx="9" cy="7" r="4" />
                <path d="m22 21-3-3" />
                <path d="m22 21-3-3" />
                <circle cx="17" cy="17" r="3" />
              </svg>
            </div>
            <h1>Attendance Portal</h1>
          </div>
          <div class="header-right">
            <button id="export-btn" class="export-btn">
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                <polyline points="7,10 12,15 17,10" />
                <line x1="12" y1="15" x2="12" y2="3" />
              </svg>
              Export
            </button>
            <button id="logout-btn" class="logout-btn">
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
                <polyline points="16,17 21,12 16,7" />
                <line x1="21" y1="12" x2="9" y2="12" />
              </svg>
              Logout
            </button>
          </div>
        </div>
      </header>

      <div class="main-content">
        <div class="sidebar">
          <div class="sidebar-card">
            <h2>Sections</h2>
            <div class="sections-list" id="sections-list">
              <!-- Sections will be generated by JavaScript -->
            </div>
          </div>
        </div>

        <div class="content">
          <div class="content-card">
            <div class="section-header">
              <div class="section-info">
                <h2 id="current-section">Section 1</h2>
                <p id="attendance-count">0 of 71 students present</p>
              </div>
              <div class="section-actions">
                <button id="mark-all-present" class="action-btn present">
                  Mark All Present
                </button>
                <button id="mark-all-absent" class="action-btn absent">
                  Mark All Absent
                </button>
              </div>
            </div>

            <div class="filters">
              <div class="search-box">
                <svg
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <circle cx="11" cy="11" r="8" />
                  <path d="m21 21-4.35-4.35" />
                </svg>
                <input
                  type="text"
                  id="search-input"
                  placeholder="Search student ID..."
                />
              </div>
              <button id="filter-present" class="filter-btn">
                <svg
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <polygon points="22,3 2,3 10,12.46 10,19 14,21 14,12.46" />
                </svg>
                Present Only
              </button>
            </div>

            <div class="students-grid" id="students-grid">
              <!-- Students will be generated by JavaScript -->
            </div>

            <div id="no-results" class="no-results hidden">
              <svg
                width="48"
                height="48"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" />
                <circle cx="9" cy="7" r="4" />
                <path d="m22 21-3-3" />
                <circle cx="17" cy="17" r="3" />
              </svg>
              <p>No students found matching your criteria</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script >
      // Application State
let currentSection = 1;
let attendanceData = {};
let filteredStudents = [];
let showOnlyPresent = false;

// Initialize the application
document.addEventListener('DOMContentLoaded', function() {
    initializeAttendanceData();
    setupEventListeners();
    generateSectionsList();
    updateStudentsDisplay();
});

// Initialize attendance data for all sections
function initializeAttendanceData() {
    let currentNumber = 4000;
    
    for (let sectionId = 1; sectionId <= 19; sectionId++) {
        const students = [];
        const studentsCount = sectionId === 1 ? 71 : 72; // Section 1 has 71 students (4000-4070), others have 72
        
        for (let i = 0; i < studentsCount; i++) {
            students.push({
                id: `231fa${String(currentNumber).padStart(5, '0')}`,
                isPresent: false
            });
            currentNumber++;
        }
        
        attendanceData[sectionId] = {
            name: `Section ${sectionId}`,
            students: students
        };
    }
}

// Setup all event listeners
function setupEventListeners() {
    // QR Scanner events
    document.getElementById('scan-btn').addEventListener('click', handleScanClick);
    document.getElementById('manual-btn').addEventListener('click', handleManualEntry);
    document.getElementById('logout-btn').addEventListener('click', handleLogout);
    
    // Portal events
    document.getElementById('mark-all-present').addEventListener('click', () => markAllAttendance(true));
    document.getElementById('mark-all-absent').addEventListener('click', () => markAllAttendance(false));
    document.getElementById('search-input').addEventListener('input', handleSearch);
    document.getElementById('filter-present').addEventListener('click', togglePresentFilter);
    document.getElementById('export-btn').addEventListener('click', exportAttendance);
}

// QR Scanner Functions
function handleScanClick() {
    const scanBtn = document.getElementById('scan-btn');
    const btnText = scanBtn.querySelector('.btn-text');
    const spinner = scanBtn.querySelector('.spinner');
    const scanLine = document.querySelector('.scan-line');
    
    // Disable button and show loading state
    scanBtn.disabled = true;
    btnText.textContent = 'Scanning...';
    spinner.classList.remove('hidden');
    scanLine.classList.add('active');
    
    // Simulate scanning process
    setTimeout(() => {
        scanLine.classList.remove('active');
        showSuccessMessage();
        
        setTimeout(() => {
            switchToPortal();
        }, 1500);
    }, 2000);
}

function handleManualEntry() {
    const code = prompt('Enter QR Code manually:');
    if (code && code.toLowerCase() === 'admin123') {
        showSuccessMessage();
        setTimeout(() => {
            switchToPortal();
        }, 1000);
    } else if (code) {
        alert('Invalid code. Try "admin123" for demo.');
    }
}

function showSuccessMessage() {
    const scanBtn = document.getElementById('scan-btn');
    const manualBtn = document.getElementById('manual-btn');
    const successMessage = document.getElementById('success-message');
    
    scanBtn.style.display = 'none';
    manualBtn.style.display = 'none';
    successMessage.classList.remove('hidden');
}

function switchToPortal() {
    document.getElementById('qr-scanner').classList.remove('active');
    document.getElementById('attendance-portal').classList.add('active');
}

function handleLogout() {
    // Reset QR scanner state
    const scanBtn = document.getElementById('scan-btn');
    const btnText = scanBtn.querySelector('.btn-text');
    const spinner = scanBtn.querySelector('.spinner');
    const successMessage = document.getElementById('success-message');
    const manualBtn = document.getElementById('manual-btn');
    
    scanBtn.disabled = false;
    btnText.textContent = 'Scan QR Code';
    spinner.classList.add('hidden');
    successMessage.classList.add('hidden');
    scanBtn.style.display = 'flex';
    manualBtn.style.display = 'block';
    
    // Switch screens
    document.getElementById('attendance-portal').classList.remove('active');
    document.getElementById('qr-scanner').classList.add('active');
}

// Portal Functions
function generateSectionsList() {
    const sectionsList = document.getElementById('sections-list');
    sectionsList.innerHTML = '';
    
    for (let sectionId = 1; sectionId <= 19; sectionId++) {
        const sectionData = attendanceData[sectionId];
        const presentCount = sectionData.students.filter(s => s.isPresent).length;
        
        const sectionElement = document.createElement('div');
        sectionElement.className = `section-item ${sectionId === currentSection ? 'active' : ''}`;
        sectionElement.innerHTML = `
            <span class="section-name">${sectionData.name}</span>
            <span class="section-count">${presentCount}/${sectionData.students.length}</span>
        `;
        
        sectionElement.addEventListener('click', () => {
            currentSection = sectionId;
            updateSectionDisplay();
            updateStudentsDisplay();
        });
        
        sectionsList.appendChild(sectionElement);
    }
}

function updateSectionDisplay() {
    // Update active section in sidebar
    document.querySelectorAll('.section-item').forEach((item, index) => {
        item.classList.toggle('active', index + 1 === currentSection);
    });
    
    // Update section header
    const sectionData = attendanceData[currentSection];
    const presentCount = sectionData.students.filter(s => s.isPresent).length;
    
    document.getElementById('current-section').textContent = sectionData.name;
    document.getElementById('attendance-count').textContent = 
        `${presentCount} of ${sectionData.students.length} students present`;
    
    // Update section counts in sidebar
    generateSectionsList();
}

function updateStudentsDisplay() {
    const sectionData = attendanceData[currentSection];
    const searchTerm = document.getElementById('search-input').value.toLowerCase();
    
    // Filter students based on search and present filter
    filteredStudents = sectionData.students.filter(student => {
        const matchesSearch = student.id.toLowerCase().includes(searchTerm);
        const matchesFilter = !showOnlyPresent || student.isPresent;
        return matchesSearch && matchesFilter;
    });
    
    const studentsGrid = document.getElementById('students-grid');
    const noResults = document.getElementById('no-results');
    
    if (filteredStudents.length === 0) {
        studentsGrid.style.display = 'none';
        noResults.classList.remove('hidden');
    } else {
        studentsGrid.style.display = 'grid';
        noResults.classList.add('hidden');
        
        studentsGrid.innerHTML = '';
        
        filteredStudents.forEach(student => {
            const studentElement = document.createElement('div');
            studentElement.className = `student-item ${student.isPresent ? 'present' : ''}`;
            studentElement.innerHTML = `
                <span class="student-id">${student.id}</span>
                <div class="checkbox">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                        <polyline points="20,6 9,17 4,12"></polyline>
                    </svg>
                </div>
            `;
            
            studentElement.addEventListener('click', () => {
                toggleStudentAttendance(student.id);
            });
            
            studentsGrid.appendChild(studentElement);
        });
    }
}

function toggleStudentAttendance(studentId) {
    const sectionData = attendanceData[currentSection];
    const student = sectionData.students.find(s => s.id === studentId);
    
    if (student) {
        student.isPresent = !student.isPresent;
        updateSectionDisplay();
        updateStudentsDisplay();
    }
}

function markAllAttendance(present) {
    const sectionData = attendanceData[currentSection];
    sectionData.students.forEach(student => {
        student.isPresent = present;
    });
    
    updateSectionDisplay();
    updateStudentsDisplay();
}

function handleSearch() {
    updateStudentsDisplay();
}

function togglePresentFilter() {
    const filterBtn = document.getElementById('filter-present');
    showOnlyPresent = !showOnlyPresent;
    
    filterBtn.classList.toggle('active', showOnlyPresent);
    updateStudentsDisplay();
}

function exportAttendance() {
    const exportData = [];
    
    for (let sectionId = 1; sectionId <= 19; sectionId++) {
        const sectionData = attendanceData[sectionId];
        const presentStudents = sectionData.students.filter(s => s.isPresent);
        
        exportData.push({
            section: sectionData.name,
            totalStudents: sectionData.students.length,
            presentStudents: presentStudents.length,
            presentList: presentStudents.map(s => s.id),
            absentStudents: sectionData.students.length - presentStudents.length,
            absentList: sectionData.students.filter(s => !s.isPresent).map(s => s.id)
        });
    }
    
    const dataStr = JSON.stringify(exportData, null, 2);
    const dataBlob = new Blob([dataStr], { type: 'application/json' });
    const url = URL.createObjectURL(dataBlob);
    
    const link = document.createElement('a');
    link.href = url;
    link.download = `attendance-${new Date().toISOString().split('T')[0]}.json`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    
    URL.revokeObjectURL(url);
    
    // Show success message
    const originalText = document.getElementById('export-btn').innerHTML;
    document.getElementById('export-btn').innerHTML = `
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
            <polyline points="22,4 12,14.01 9,11.01"/>
        </svg>
        Exported!
    `;
    
    setTimeout(() => {
        document.getElementById('export-btn').innerHTML = originalText;
    }, 2000);
}
    </script>
  </body>
</html>
